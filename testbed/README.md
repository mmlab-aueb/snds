# SNDS Testbed experiments

## Preparation

In order to execute this experiments you need to obtain a certificate for a 
prefix following [these instructions](https://named-data.net/ndn-testbed/user-guide-to-obtain-a-testbed-certificate/).

Then replace the `prefix` variable in each script with your prefix. 

Moreover, for all your experiment you must have installed [python-ndn](https://github.com/named-data/python-ndn).

## NFD setup

All experiments include the below scripts that outline the bare minimum of commands you need to run in order to connect to testbed.

In the producer machine the ``run_nfd_producer.sh`` must be run: 

```sh
chmod +x run_nfd_producer.sh
sudo ./run_nfd_producer.sh
```

In the consumer machine the ``run_nfd_consumer.sh`` must be run: 

```sh
chmod +x run_nfd_consumer.sh
sudo ./run_nfd_consumer.sh
```

These will output the following log files which you can use to debug:

- nfd_producer.log
- nfd_consumer.log

If these don't work for you, you can run the individual commands of the scripts in your terminal.

## Experiment 1

This is a proof of concept that a simple case where a producer provider the type ``Car`` with ``id=1`` works on the ``testbed`` network.

It outputs detailed logs about the execution and the execution time of the requests.


### Execution

First in the producer machine run the producer script.

```cmd
python run_producer.py --type Car --id 1 

//or in general

python run_producer.py --type <type> --id <id>
```

The above opens two threads to service requests for the scripts ``SNDS_r_service.py`` and the ``SNDS_service.py``.

The ``SNDS_r_service.py`` listens to the ``snds/Car`` and the ``snds/Car_registry`` routes. 

The ``SNDS_service.py`` listens to the ``snds/1`` 1 being the ``<id>`` and the ``snds/1/<rid>``. The ``<rid>`` is a random ID generated when the program is run.

Then, in the consumer machine run the consumer scripts together or individually:

```cmd
//together 
python run_consume_experiment --type Car --id 1

//seperately 
python closest_node_by_id.py --id 1
python closest_node_by_type.py --type Car
```

If you run the first you will see a profiled run of the scripts outlining the execution times of each and the logs of the corresponding script. 

If you run the seperate version you will not see the profiles generated by the ``run_consume_experiment.py`` script.

You should get the ``1.jsonld`` file from the producer, use it as a debug tool.


## Experiment 2
An experiment that demonstrates signing of content items using Decentralized Identifiers.

### Preparation
This experiment requires jwcrypto library. Install it using

```
python3 -m pip install jwcrypto
```

It also requires the python implementation of did:self. This [can be found here](https://github.com/excid-io/did-self-py).

### Execution
In the producer machine run the `run_producer.py` script

```cmd
python3 run_producer.py
```

This script generates and signs a data item. Then in the consumer machine run the
`closest_node_by_id.py` script

```cmd
python3 closest_node_by_id.py
```

